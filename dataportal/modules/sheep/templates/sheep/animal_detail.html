{% extends 'base.html' %}
{% load email_obfuscator lonlat %}

{% block title %}
{{ block.super }} - Sample for {{ animal }}
{% endblock %}

{% block main %}
  <p>
    <a href="{% url 'sheep:animal-list' %}">Back to list</a>
  </p>
  <h3>{{ animal }}</h3>
  <div id="mapid" style="height:320px;"></div>
  <table class="table table-striped table-hover">
    <tr>
      <th>Animal sex</th>
      <td>{{ animal.animal_sex }}</td>
    </tr>
    <tr>
      <th>Species</th>
      <td>{{ animal.species }}</td>
    </tr>
    <tr>
      <th>NCBI taxonomy</th>
      <td>{{ animal.species.ncbi_taxonomy_html }}</td>
    </tr>
    <tr>
      <th>Sampling date</th>
      <td>{{ animal.sampling.date }}</td>
    </tr>
    <tr>
      <th>Sampling site</th>
      <td>{{ animal.sampling.get_site_display }}</td>
    </tr>
    <tr>
      <th>Sampling geolocation</th>
      <td>{{ animal.sampling.geolocation.x|longitude }} {{ animal.sampling.geolocation.y|latitude }}</td>
    </tr>
    <tr>
      <th>Sampling altitude</th>
      <td>{{ animal.sampling.altitude_display }}</td>
    </tr>
    <tr>
      <th>Sampling locality</th>
      <td>{{ animal.sampling.locality }}</td>
    </tr>
    <tr>
      <th>Sampling administrative area</th>
      <td>{{ animal.sampling.administrative_area.all.0.administrative_area }}</td>
    </tr>
    <tr>
      <th>Population possible related breed</th>
      <td>{{ animal.sampling.population.possible_related_breed }}</td>
    </tr>
    <tr>
      <th>Population tail type</th>
      <td>{{ animal.sampling.population.get_tail_type_display }}</td>
    </tr>
    <tr>
      <th>Population tail shape</th>
      <td>{{ animal.sampling.population.get_tail_shape_display }}</td>
    </tr>
    <tr>
        <th>Sample name (access to NCBI)</th>
        <td><a href="{{ animal.accession_url }}">{{ animal.sample_name }}</a></td>
    </tr>
    <tr>
      <th>Study</th>
      <td>{{ animal.sampling.study }}</td>
    </tr>
    <tr>
      <th>Contact person</th>
      <td>{{ animal.sampling.study.contact_person|obfuscate }}</td>
    </tr>
  </table>
  <input type="hidden" id="boundary" value="{{ animal.sampling.administrative_area.all.0.administrative_area.adm_1.geom.geojson }}">
  <!-- input type="hidden" id="boundary" value="{% firstof animal.sampling.administrative_area.all.0.administrative_area.geom.geojson animal.sampling.administrative_area.all.0.administrative_area.geom.adm_1.geojson %}" -->
  <input type="hidden" id="country" value="{{ animal.sampling.administrative_area.all.0.administrative_area.country.geom.geojson }}">
  <input type="hidden" id="point" value="{{ animal.sampling.geolocation.geojson }}">
{% endblock %}

{% block javascript %}
<script>
  var mymap = L.map('mapid').setView([0, 30], 4);
  L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}',
    {
      attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
      maxZoom: 18,
      id: 'mapbox/streets-v11',
      tileSize: 512,
      zoomOffset: -1,
      accessToken: 'pk.eyJ1IjoiY2V6YXJwZW5kYXJvdnNraSIsImEiOiJja3pmZnpvNDMyc3l5Mm5ueDI4Z3c3MGtpIn0.ao1qoYHmpT3wfX7F9Nz1Ng'
    }
  ).addTo(mymap);

  var boundary = JSON.parse($('#boundary').val());
  var admlevel = L.geoJSON(boundary, {
    style: {
      color: '#ff0000'
    }
  }).addTo(mymap);
  var country = JSON.parse($('#country').val());
  var country_border = L.geoJSON(country, {}).addTo(mymap);
  mymap.fitBounds(country_border.getBounds());
  var point = JSON.parse($('#point').val());
  var marker = L.geoJSON(point, {}).addTo(mymap);
</script>
{% endblock %}
