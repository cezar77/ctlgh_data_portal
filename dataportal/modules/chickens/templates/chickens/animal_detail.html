{% extends 'base.html' %}
{% load email_obfuscator lonlat %}

{% block main %}
  <p>
    <a href="{% url 'chickens:animal-list' %}">Back to list</a>
  </p>
  <h3>{{ animal }}</h3>
  <div id="mapid" style="height:320px;"></div>
  <table class="table table-striped table-hover">
    <tr>
      <th>Animal sex</th>
      <td>{{ animal.animal_sex }}</td>
    </tr>
    <tr>
      <th>Species</th>
      <td>{{ animal.species }}</td>
    </tr>
    <tr>
      <th>NCBI taxonomy</th>
      <td>{{ animal.species.ncbi_taxonomy_html }}</td>
    </tr>
    <tr>
      <th>Sampling date</th>
      <td>{{ animal.sampling.date }}</td>
    </tr>
    <tr>
      <th>Farm geolocation</th>
      <td>{{ animal.farm.geolocation.x|longitude }} {{ animal.farm.geolocation.y|latitude }}</td>
    </tr>
    <tr>
      <th>Farm altitude</th>
      <td>{{ animal.farm.altitude }} m a.s.l.</td>
    </tr>
    <tr>
      <th>Farm locality</th>
      <td>{{ animal.farm.village }}</td>
    </tr>
    <tr>
      <th>Farm administrative area</th>
      <td>{{ animal.farm.administrative_area.all.0.administrative_area }}</td>
    </tr>
    <tr>
      <th>Study</th>
      <td>{{ animal.sampling.study }}</td>
    </tr>
    <tr>
      <th>Contact person</th>
      <td>{{ animal.sampling.study.contact_person|obfuscate }}</td>
    </tr>
  </table>
  <input type="hidden" id="boundary" value="{{ animal.farm.administrative_area.all.0.administrative_area.geom.geojson }}">
  <input type="hidden" id="country" value="{{ animal.farm.administrative_area.all.0.administrative_area.country.geom.geojson }}">
  <input type="hidden" id="point" value="{{ animal.farm.geolocation.geojson }}">
{% endblock %}

{% block javascript %}
<script>
  var mymap = L.map('mapid').setView([0, 30], 4);
  L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}',
    {
      attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
      maxZoom: 18,
      id: 'mapbox.streets',
      accessToken: 'pk.eyJ1IjoiY2V6YXJwZW5kYXJvdnNraSIsImEiOiJjajlvNWMyaWE1Y3BiMnFucnRuOXp2MzJ4In0.cnFLASbZTkfE7mh56YNn5w'
    }
  ).addTo(mymap);

  var boundary = JSON.parse($('#boundary').val());
  var admlevel = L.geoJSON(boundary, {
    style: {
      color: '#ff0000'
    }
  }).addTo(mymap);
  var country = JSON.parse($('#country').val());
  var country_border = L.geoJSON(country, {}).addTo(mymap);
  mymap.fitBounds(country_border.getBounds());
  var point = JSON.parse($('#point').val());
  var marker = L.geoJSON(point, {}).addTo(mymap);
</script>
{% endblock %}
